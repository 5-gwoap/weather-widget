<!DOCTYPE html>
<html>
<head>
<title>Weather</title>
<script>
	(function gettingJSON() {
		if (!process.env.WEATHER_TOKEN) {
			document.write('Please provide data for the following variables:');
		} else {
			document.write('Loading weather...')
			
		}
	})();

	function getWeather() {
		var request = require('request');

		var options = { 
			method: 'GET',
			url: 'http://api.openweathermap.org/data/2.5/weather',
			qs: {
				id: process.env.WEATHER_CITY,
				appid: process.env.WEATHER_TOKEN,
				units: 'imperial',
			},
			headers: 
				{ 'Postman-Token': '17df63ff-3e5b-39f3-4e09-1f1a8ce00114',
				'Cache-Control': 'no-cache' } };

		request(options, function (error, response, body) {
		if (error) throw new Error(error);
		
		body = JSON.parse(body);

		var desc = body.weather[0].main;
		var temp = body.main.temp;

		document.write("<h1>" + desc + ' - ' + temp + "</h1>");
		});
	}

	function setVars() {
		console.log('THIS IS A TEST');
		process.env.WEATHER_TOKEN = document.getElementById('weatherToken').value;
		process.env.WEATHER_CITY= document.getElementById('city').value;

		console.log('weather tok', process.env.WEATHER_TOKEN);

		getWeather();
	}
	</script>
</head>
<body>
	<form method="LINK" action="index.html" onSubmit="setVars()">
		<input id="weatherToken" placeholder="Weather Token" />
		<input id="city" placeholder="City" />
		<input type="submit" />
	</form>
</body>
</html>